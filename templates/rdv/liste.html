{% extends "base.html" %}

{% block title %}Mes Rendez-vous - Gestion de Rendez-vous M√©dicaux{% endblock %}

{% block content %}
<div class="card">
    <div class="card-header">
        <h1 class="card-title">Mes Rendez-vous</h1>
        <p class="card-subtitle">Consultez et g√©rez tous vos rendez-vous</p>
    </div>
    
    <div style="margin-bottom: 2rem;">
        <a href="{{ url_for('nouveau_rdv') }}" class="btn btn-primary">
            üìÖ Prendre un nouveau rendez-vous
        </a>
    </div>

    {% if rendez_vous %}
        <div style="display: grid; gap: 1.5rem;">
            {% for rdv in rendez_vous %}
                <div class="card" style="border-left: 4px solid 
                    {% if rdv.statut == 'planifie' %}var(--success-color)
                    {% elif rdv.statut == 'annule' %}var(--danger-color)
                    {% elif rdv.statut == 'confirme' %}var(--info-color)
                    {% elif rdv.statut == 'termine' %}var(--secondary-color)
                    {% else %}var(--warning-color){% endif %};">
                    
                    <div style="display: flex; justify-content: space-between; align-items: start; margin-bottom: 1rem;">
                        <div>
                            <h3 style="margin: 0 0 0.5rem 0; color: var(--text-dark);">
                                Dr {{ rdv.medecin_prenom }} {{ rdv.medecin_nom }}
                            </h3>
                            <p style="margin: 0; color: var(--text-light); font-size: 0.875rem;">
                                {{ rdv.specialite }}
                            </p>
                        </div>
                        <span class="badge 
                            {% if rdv.statut == 'planifie' %}badge-success
                            {% elif rdv.statut == 'annule' %}badge-danger
                            {% elif rdv.statut == 'confirme' %}badge-info
                            {% elif rdv.statut == 'termine' %}badge-secondary
                            {% else %}badge-warning{% endif %}">
                            {{ rdv.statut|capitalize }}
                        </span>
                    </div>

                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 1rem; margin-bottom: 1rem;">
                        <div>
                            <strong style="color: var(--text-dark);">üìÖ Date et heure</strong><br>
                            <span style="color: var(--text-light);">{{ rdv.date_heure.strftime('%d/%m/%Y √† %H:%M') }}</span>
                        </div>
                        
                        {% if rdv.motif %}
                        <div>
                            <strong style="color: var(--text-dark);">üí¨ Motif</strong><br>
                            <span style="color: var(--text-light);">{{ rdv.motif }}</span>
                        </div>
                        {% endif %}
                        
                        <div>
                            <strong style="color: var(--text-dark);">üìã Cr√©√© le</strong><br>
                            <span style="color: var(--text-light);">{{ rdv.date_creation.strftime('%d/%m/%Y') }}</span>
                        </div>
                    </div>

                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <a href="{{ url_for('rdv_details', rdv_id=rdv.id) }}" class="btn btn-outline">
                            üëÅÔ∏è Voir d√©tails
                        </a>
                        
                        {% if rdv.statut == 'planifie' %}
                            <form method="POST" action="{{ url_for('annuler_rdv', rdv_id=rdv.id) }}" style="display: inline;" 
                                  onsubmit="return confirm('√ätes-vous s√ªr de vouloir annuler ce rendez-vous ?');">
                                <button type="submit" class="btn btn-danger">
                                    ‚ùå Annuler
                                </button>
                            </form>
                        {% endif %}
                    </div>
                </div>
            {% endfor %}
        </div>

        <!-- Pagination ou statistiques -->
        <div class="card" style="margin-top: 2rem; text-align: center;">
            <h3 style="margin-bottom: 1rem;">Statistiques</h3>
            <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem;">
                <div>
                    <div style="font-size: 2rem; color: var(--primary-color);">{{ rendez_vous|length }}</div>
                    <div style="color: var(--text-light);">Total</div>
                </div>
                <div>
                    <div style="font-size: 2rem; color: var(--success-color);">
                        {{ rendez_vous|selectattr("statut", "equalto", "planifie")|list|length }}
                    </div>
                    <div style="color: var(--text-light);">Programm√©s</div>
                </div>
                <div>
                    <div style="font-size: 2rem; color: var(--danger-color);">
                        {{ rendez_vous|selectattr("statut", "equalto", "annule")|list|length }}
                    </div>
                    <div style="color: var(--text-light);">Annul√©s</div>
                </div>
            </div>
        </div>

    {% else %}
        <div style="text-align: center; padding: 4rem 2rem; color: var(--text-light);">
            <div style="font-size: 4rem; margin-bottom: 1rem;">üìÖ</div>
            <h2 style="margin-bottom: 1rem; color: var(--text-dark);">Aucun rendez-vous</h2>
            <p style="margin-bottom: 2rem;">Vous n'avez pas encore pris de rendez-vous.</p>
            <a href="{{ url_for('nouveau_rdv') }}" class="btn btn-primary">
                Prendre votre premier rendez-vous
            </a>
        </div>
    {% endif %}
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Animation d'apparition des cartes
    const rdvCards = document.querySelectorAll('.card');
    rdvCards.forEach((card, index) => {
        setTimeout(() => {
            card.style.opacity = '0';
            card.style.transform = 'translateY(20px)';
            card.style.transition = 'opacity 0.5s ease, transform 0.5s ease';
            
            setTimeout(() => {
                card.style.opacity = '1';
                card.style.transform = 'translateY(0)';
            }, 50);
        }, index * 100);
    });

    // Confirmation d'annulation avec style
    const cancelForms = document.querySelectorAll('form[action*="annuler"]');
    cancelForms.forEach(form => {
        form.addEventListener('submit', function(e) {
            e.preventDefault();
            
            const confirmDialog = confirm(
                '√ätes-vous s√ªr de vouloir annuler ce rendez-vous ?\n\n' +
                'Cette action est irr√©versible.'
            );
            
            if (confirmDialog) {
                const submitBtn = this.querySelector('button[type="submit"]');
                submitBtn.innerHTML = 'Annulation...';
                submitBtn.disabled = true;
                this.submit();
            }
        });
    });

    // Filtrage par statut (fonctionnalit√© future)
    const statusFilter = document.createElement('select');
    statusFilter.className = 'form-control form-select';
    statusFilter.style.maxWidth = '200px';
    statusFilter.style.marginBottom = '1rem';
    statusFilter.innerHTML = `
        <option value="">Tous les statuts</option>
        <option value="Programm√©">Programm√©s</option>
        <option value="Annul√©">Annul√©s</option>
    `;
    
    // Ins√©rer le filtre avant la liste des rendez-vous
    const rdvContainer = document.querySelector('.card');
    if (rdvContainer && {{ rendez_vous|length }} > 0) {
        const filterContainer = document.createElement('div');
        filterContainer.style.marginBottom = '1rem';
        filterContainer.appendChild(statusFilter);
        rdvContainer.appendChild(filterContainer);
    }
});
</script>
{% endblock %}

